<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>–ò–≥—Ä–∞ ‚Äî –°–æ–±–µ—Ä–∏ —Ä–∞—Å—Å–∫–∞–∑</title>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Comfortaa:wght@400;700&display=swap');
    
    :root{
        --bg1: #fbc2eb;
        --bg2: #a6c1ee;
        --bg3: #ffb6c1;
        --card: #ffffff;
        --accent: #6a5acd;
        --accent2: #ff6f91;
        --ok: #2ecc71;
        --bad: #ff4e88;
        --text: #4a2d0f; /* –¢–µ–º–Ω–æ-–∫–æ—Ä–∏—á–Ω–µ–≤—ã–π —Ç–µ–∫—Å—Ç */
    }

    * {box-sizing: border-box;}
    html, body {
        height: 100%;
        margin: 0;
        font-family: 'Comfortaa', cursive, sans-serif;
        color: var(--text);
    }
    
    body {
        background: linear-gradient(135deg, var(--bg1), var(--bg2), var(--bg3));
        background-size: 400% 400%;
        animation: gradientMove 15s ease infinite;
        display: flex;
        align-items: flex-start;
        justify-content: center;
        padding: 28px;
    }

    /* –ê–Ω–∏–º–∞—Ü–∏—è –¥–≤–∏–∂–µ–Ω–∏—è –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞ */
    @keyframes gradientMove {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }

    .app { width: min(1100px, 98%); }
    
    header {
        display: flex;
        gap: 16px;
        align-items: center;
        margin-bottom: 18px;
        flex-wrap: wrap;
    }
    
    h1 {
        margin: 0;
        font-size: 2.5em; /* –£–≤–µ–ª–∏—á–∏–ª —Ä–∞–∑–º–µ—Ä */
        color: var(--accent);
        text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
    }
    
    .top-info {
        margin-left: auto;
        display: flex;
        gap: 10px;
        align-items: center;
    }
    
    .pill {
        background: var(--card);
        padding: 8px 12px;
        border-radius: 999px;
        box-shadow: 0 8px 24px rgba(40, 40, 60, .06);
        font-weight: 700;
        transition: transform 0.3s ease;
    }

    .pill:hover {
        transform: scale(1.05);
    }

    .grid {
        display: grid;
        grid-template-columns: 360px 1fr;
        gap: 16px;
    }

    @media (max-width: 900px) {
        .grid { grid-template-columns: 1fr; }
        .left { order: 2; }
        .right { order: 1; }
    }

    /* left column */
    .left {
        height: calc(100vh - 140px);
        overflow-y: auto; /* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: overflow-y –≤–º–µ—Å—Ç–æ overflow */
        padding: 12px;
    }
    
    .story-card {
        background: var(--card);
        border-radius: 12px;
        padding: 12px;
        margin-bottom: 10px;
        box-shadow: 0 10px 30px rgba(30, 40, 60, .06);
        transition: transform .18s, box-shadow .18s;
        cursor: pointer;
    }
    
    .story-card:hover {
        transform: translateY(-6px) scale(1.01);
        box-shadow: 0 18px 40px rgba(30, 40, 60, .09);
    }
    
    .story-card h3 {
        margin: 0 0 6px;
        font-size: 1.1em;
        color: var(--accent);
    }
    
    .story-card p {
        margin: 0;
        color: rgba(31, 45, 61, .7);
        font-size: 0.9em;
    }

    /* right column */
    .right {
        padding: 14px;
        background: rgba(255, 255, 255, .9);
        border-radius: 12px;
        box-shadow: 0 12px 36px rgba(34, 40, 60, .06);
        min-height: 420px;
        border: 2px solid var(--bg2); /* –î–æ–±–∞–≤–∏–ª —Ä–∞–º–∫—É –≤ —Ç–æ–Ω –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞ */
    }
    
    .reader {
        padding: 10px;
        border-radius: 10px;
        background: linear-gradient(180deg, #fff, #fbfbff);
        min-height: 110px;
        overflow-y: auto; /* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ */
        box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    
    .controls {
        display: flex;
        gap: 10px;
        margin-top: 12px;
        flex-wrap: wrap;
        align-items: center;
    }
    
    .btn {
        background: linear-gradient(135deg, var(--accent), var(--accent2));
        color: #fff;
        border: 0;
        padding: 10px 14px;
        border-radius: 10px;
        font-weight: 800;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }
    
    .btn.ghost {
        background: #fff;
        color: var(--accent);
        border: 2px solid var(--accent); /* –ò–∑–º–µ–Ω–∏–ª —Ü–≤–µ—Ç —Ä–∞–º–∫–∏ –Ω–∞ –∞–∫—Ü–µ–Ω—Ç–Ω—ã–π */
    }

    .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        background: linear-gradient(135deg, var(--accent2), var(--accent));
    }

    .btn.ghost:hover {
        background: var(--accent);
        color: #fff;
    }

    .pieces {
        margin-top: 12px;
        min-height: 200px;
        padding: 12px;
        border-radius: 12px;
        border: 2px dashed var(--accent2); /* –ò–∑–º–µ–Ω–∏–ª —Ü–≤–µ—Ç dashed-—Ä–∞–º–∫–∏ */
        display: flex;
        flex-direction: column;
        gap: 8px;
    }
    
    .piece {
        background: #fff;
        padding: 10px 12px;
        border-radius: 10px;
        box-shadow: 0 8px 20px rgba(30, 40, 60, .05);
        cursor: grab;
        user-select: none;
        transition: transform .12s, box-shadow .12s;
        font-size: 0.95em;
    }
    
    .piece.dragging {
        opacity: .5;
        transform: scale(.98);
    }
    
    .piece.ok {
        border-left: 6px solid var(--ok);
    }
    
    .piece.bad {
        border-left: 6px solid var(--bad);
    }
    
    .hint {
        color: rgba(31, 45, 61, .45);
        font-size: 14px;
        padding: 14px;
        text-align: center;
    }

    .footer {
        margin-top: 12px;
        color: rgba(31, 45, 61, .6);
        font-size: 13px;
    }

    /* small helpers */
    .muted {
        color: rgba(31, 45, 61, .5);
        font-size: 13px;
    }
    
    .score {
        font-weight: 900;
        color: var(--accent2);
    }
    
    .status {
        font-weight: 800;
    }

    .timer {
        font-weight: bold;
        color: var(--accent);
        margin-left: auto;
    }
</style>
</head>
<body>
<div class="app" role="application" aria-label="–ò–≥—Ä–∞ –°–æ–±–µ—Ä–∏ —Ä–∞—Å—Å–∫–∞–∑">
    <header>
        <h1>üéí –°–æ–±–µ—Ä–∏ —Ä–∞—Å—Å–∫–∞–∑</h1>
        <div class="muted">–í—ã–±–µ—Ä–∏ —Ä–∞—Å—Å–∫–∞–∑ ‚Äî –æ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–º–µ—à–∞–µ—Ç—Å—è. –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ.</div>
        <div class="top-info">
            <div class="pill">–û—á–∫–∏: <span id="score">0</span></div>
            <div class="pill">–ó–∞–¥–∞–Ω–∏–µ: <span id="taskIndex">‚Äî</span></div>
        </div>
    </header>

    <div class="grid">
        <aside class="left" id="list">
            </aside>

        <main class="right" id="main">
            <div class="reader" id="reader">
                <strong id="readerTitle">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞—Å—Å–∫–∞–∑ —Å–ª–µ–≤–∞</strong>
                <p id="readerText" class="muted">–¢–µ–∫—Å—Ç –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É ‚Äî –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –±—É–¥—É—Ç –ø–µ—Ä–µ–º–µ—à–∞–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.</p>
            </div>

            <div class="controls" style="margin-top:10px">
                <button class="btn" id="shuffleBtn">–ü–µ—Ä–µ–º–µ—à–∞—Ç—å</button>
                <button class="btn" id="checkBtn">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
                <button class="btn ghost" id="resetBtn">–°–±—Ä–æ—Å–∏—Ç—å</button>
                <button class="btn ghost" id="hintBtn">–ü–æ–¥—Å–∫–∞–∑–∫–∞ (-1 –æ—á–∫–æ)</button>
                <div class="timer" id="timer"></div>
            </div>

            <div class="pieces" id="pieces" aria-live="polite">
                <div class="hint" id="piecesHint">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–∞—Å—Å–∫–∞–∑</div>
            </div>

            <div class="footer">
                <div id="result" class="status"></div>
            </div>
        </main>
    </div>
</div>

<script>
    /* ====== –î–∞–Ω–Ω—ã–µ: 22 —Ä–∞—Å—Å–∫–∞–∑–∞ ====== */
    const stories = [
        {title:"–ö–æ—Ç—ë–Ω–æ–∫ –∏ –∫–ª—É–±–æ–∫", text:"–£ –í–∏–∫–∏ –∂–∏–ª –∫–æ—Ç—ë–Ω–æ–∫. –û–Ω–∞ –¥–∞–ª–∞ –µ–º—É –∫–ª—É–±–æ–∫ –Ω–∏—Ç–æ–∫. –ö–æ—Ç—ë–Ω–æ–∫ —Ç–æ–ª–∫–Ω—É–ª –µ–≥–æ –ª–∞–ø–∫–æ–π, –∏ –∫–ª—É–±–æ–∫ –ø–æ–∫–∞—Ç–∏–ª—Å—è –ø–æ –ø–æ–ª—É. –ö–æ—Ç—ë–Ω–æ–∫ –±–µ–≥–∞–ª –∑–∞ –Ω–∏–º –∏ –≤–µ—Å–µ–ª–æ –ø—Ä—ã–≥–∞–ª. –í–∏–∫–∞ —Å–º–µ—è–ª–∞—Å—å –∏ —Å–º–æ—Ç—Ä–µ–ª–∞ –Ω–∞ –∏–≥—Ä—É."},
        {title:"–ë–µ–ª–æ—á–∫–∞ –∏ –æ—Ä–µ—à–∫–∏", text:"–í –ª–µ—Å—É –∂–∏–ª–∞ –±–µ–ª–æ—á–∫–∞. –û–Ω–∞ –≤—Å—ë –ª–µ—Ç–æ —Å–æ–±–∏—Ä–∞–ª–∞ –æ—Ä–µ—à–∫–∏ –∏ –ø—Ä—è—Ç–∞–ª–∞ –∏—Ö –≤ –¥—É–ø–ª–æ. –û—Å–µ–Ω—å—é –≤–µ—Ç–µ—Ä —Å—Ä—ã–≤–∞–ª –ª–∏—Å—Ç—å—è, –∏ –±–µ–ª–æ—á–∫–∞ –ø—Ä–æ–≤–µ—Ä—è–ª–∞ —Å–≤–æ–∏ –∑–∞–ø–∞—Å—ã. –ò–Ω–æ–≥–¥–∞ –æ–Ω–∞ –∑–∞–±—ã–≤–∞–ª–∞, –∫—É–¥–∞ –ø–æ–ª–æ–∂–∏–ª–∞ –æ—Ä–µ—Ö. –ù–æ –≤–µ—Å–Ω–æ–π –∏–∑ –Ω–∏—Ö –≤—ã—Ä–∞—Å—Ç–∞–ª–∏ –Ω–æ–≤—ã–µ –¥–µ—Ä–µ–≤—å—è."},
        {title:"–õ–∏—Å–∞ –∏ —è–≥–æ–¥—ã", text:"–í –ª–µ—Å—É —Å–æ–∑—Ä–µ–ª–∏ —Å–ª–∞–¥–∫–∏–µ —è–≥–æ–¥—ã. –õ–∏—Å–∞ —à–ª–∞ –ø–æ —Ç—Ä–æ–ø–∏–Ω–∫–µ –∏ —É–≤–∏–¥–µ–ª–∞ –∫—É—Å—Ç. –û–Ω–∞ –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ —Å—ä–µ–ª–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —è–≥–æ–¥. –ü–æ—Ç–æ–º —É—Å–ª—ã—à–∞–ª–∞ —à–∞–≥–∏ –∏ –±—ã—Å—Ç—Ä–æ —Å–ø—Ä—è—Ç–∞–ª–∞—Å—å. –í—Å–∫–æ—Ä–µ —Ç—Ä–æ–ø–∏–Ω–∫–∞ –æ–ø—É—Å—Ç–µ–ª–∞, –∏ –ª–∏—Å–∞ —Å–Ω–æ–≤–∞ –≤–µ—Ä–Ω—É–ª–∞—Å—å –∫ –∫—É—Å—Ç—É."},
        {title:"–û—Å–µ–Ω—å", text:"–û—Å–µ–Ω—å—é –¥–µ—Ä–µ–≤—å—è –Ω–∞–¥–µ–ª–∏ —Ä–∞–∑–Ω–æ—Ü–≤–µ—Ç–Ω—ã–µ –Ω–∞—Ä—è–¥—ã. –õ–∏—Å—Ç—å—è –∫—Ä—É–∂–∏–ª–∏—Å—å –∏ —Ç–∏—Ö–æ –ø–∞–¥–∞–ª–∏ –Ω–∞ –∑–µ–º–ª—é. –î–µ—Ç–∏ —Å–æ–±–∏—Ä–∞–ª–∏ –±—É–∫–µ—Ç—ã –∏–∑ –∫–ª–µ–Ω–æ–≤—ã—Ö –ª–∏—Å—Ç—å–µ–≤. –í —Å–∞–¥–∞—Ö –ø–æ—Å–ø–µ–ª–∏ —è–±–ª–æ–∫–∏ –∏ –≥—Ä—É—à–∏. –ù–∞ –æ–≥–æ—Ä–æ–¥–∞—Ö —Å–æ–±–∏—Ä–∞–ª–∏ —É—Ä–æ–∂–∞–π –æ–≤–æ—â–µ–π. –ß–∞—Å—Ç–æ —à—ë–ª –¥–æ–∂–¥—å, –∏ –ø–æ –ª—É–∂–∞–º –ø—Ä—ã–≥–∞–ª–∏ –≤–æ—Ä–æ–±—å–∏. –£—Ç—Ä–æ–º —Å—Ç–∞–Ω–æ–≤–∏–ª–æ—Å—å –ø—Ä–æ—Ö–ª–∞–¥–Ω–µ–µ. –û—Å–µ–Ω—å –≥–æ—Ç–æ–≤–∏–ª–∞ –ø—Ä–∏—Ä–æ–¥—É –∫ –∑–∏–º–Ω–µ–º—É —Å–Ω—É."},
        {title:"–°–æ–±–∞–∫–∞ –∏ –º—è—á", text:"–ú–∞–ª—å—á–∏–∫ –±—Ä–æ—Å–∏–ª –º—è—á –≤ —Ç—Ä–∞–≤—É. –ï–≥–æ —Å–æ–±–∞–∫–∞ –±—ã—Å—Ç—Ä–æ –ø–æ–±–µ–∂–∞–ª–∞ –∏ –ø–æ–π–º–∞–ª–∞ –µ–≥–æ. –û–Ω–∞ –≤–µ—Ä–Ω—É–ª–∞—Å—å –∫ —Ö–æ–∑—è–∏–Ω—É –∏ –ø–æ–ª–æ–∂–∏–ª–∞ –º—è—á –∫ –Ω–æ–≥–∞–º. –ú–∞–ª—å—á–∏–∫ —Å–Ω–æ–≤–∞ –±—Ä–æ—Å–∏–ª –º—è—á. –¢–∞–∫ –æ–Ω–∏ –∏–≥—Ä–∞–ª–∏ —Ü–µ–ª—ã–π –≤–µ—á–µ—Ä."},
        {title:"–ó–∞–π—á–æ–Ω–æ–∫ –∏ –∫–∞–ø—É—Å—Ç–∞", text:"–í –æ–≥–æ—Ä–æ–¥–µ —Ä–æ—Å–ª–∞ –∫–∞–ø—É—Å—Ç–∞. –ö –∑–∞–±–æ—Ä—É –ø–æ–¥–±–µ–∂–∞–ª –º–∞–ª–µ–Ω—å–∫–∏–π –∑–∞–π—á–æ–Ω–æ–∫. –û–Ω –ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞–ª –≤–∫—É—Å–Ω—ã–π –∑–∞–ø–∞—Ö –∏ –æ—Ç–∫—É—Å–∏–ª –ª–∏—Å—Ç–æ—á–µ–∫. –í–¥—Ä—É–≥ –≤—ã—à–ª–∞ —Ö–æ–∑—è–π–∫–∞. –ó–∞–π—á–æ–Ω–æ–∫ –∏—Å–ø—É–≥–∞–ª—Å—è –∏ —É–±–µ–∂–∞–ª –≤ –ª–µ—Å."},
        {title:"–ó–∞–π—á–æ–Ω–æ–∫ –∏ –ø–µ—Ä–≤—ã–π —Å–Ω–µ–≥", text:"–û–¥–Ω–∞–∂–¥—ã —É—Ç—Ä–æ–º –∑–∞–π—á–æ–Ω–æ–∫ –ø—Ä–æ—Å–Ω—É–ª—Å—è –∏ —É–≤–∏–¥–µ–ª —Å–Ω–µ–≥. –õ–µ—Å —Å—Ç–∞–ª –±–µ–ª—ã–º –∏ —Ç–∏—Ö–∏–º. –ó–∞–π—á–æ–Ω–æ–∫ —Ä–∞–¥–æ—Å—Ç–Ω–æ –ø—Ä—ã–≥–∞–ª –ø–æ —Å—É–≥—Ä–æ–±–∞–º. –ï–≥–æ —Å–ª–µ–¥—ã –æ—Å—Ç–∞–≤–∞–ª–∏—Å—å –Ω–∞ —Å–Ω–µ–≥—É. –ó–∞–π—á–æ–Ω–æ–∫ –ø–æ–Ω—è–ª, —á—Ç–æ –∑–∏–º–∞ –ø—Ä–∏—à–ª–∞."},
        {title:"–í–æ—Ä–æ–±–µ–π –Ω–∞ –ø–æ–¥–æ–∫–æ–Ω–Ω–∏–∫–µ", text:"–ó–∏–º–æ–π –≤–æ—Ä–æ–±–µ–π –ø—Ä–∏–ª–µ—Ç–µ–ª –∫ –æ–∫–Ω—É. –ù–∞ –ø–æ–¥–æ–∫–æ–Ω–Ω–∏–∫–µ –ª–µ–∂–∞–ª–∏ —Ö–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏. –û–Ω –ø—Ä—ã–≥–∞–ª –∏ –∫–ª–µ–≤–∞–ª –∑–µ—Ä–Ω–æ. –î–µ—Ç–∏ —Ç–∏—Ö–æ –Ω–∞–±–ª—é–¥–∞–ª–∏, —á—Ç–æ–±—ã –Ω–µ —Å–ø—É–≥–Ω—É—Ç—å. –í–æ—Ä–æ–±–µ–π –ø–æ–µ–ª –∏ —Å–Ω–æ–≤–∞ —É–ª–µ—Ç–µ–ª."},
        {title:"–Å–ª–æ—á–∫–∞ –∏ —Å–Ω–µ–≥", text:"–í –ª–µ—Å—É —Å—Ç–æ—è–ª–∞ –º–∞–ª–µ–Ω—å–∫–∞—è —ë–ª–æ—á–∫–∞. –ù–∞—Å—Ç—É–ø–∏–ª–∞ –∑–∏–º–∞, –∏ –µ—ë –ø–æ–∫—Ä—ã–ª–∏ –±–µ–ª—ã–µ —Å—É–≥—Ä–æ–±—ã. –°–Ω–µ–∂–∏–Ω–∫–∏ –±–ª–µ—Å—Ç–µ–ª–∏ –Ω–∞ –≤–µ—Ç–∫–∞—Ö. –Å–ª–æ—á–∫–∞ —Ä–∞–¥–æ–≤–∞–ª–∞—Å—å, —á—Ç–æ —Å—Ç–∞–ª–∞ —Ç–∞–∫–æ–π –∫—Ä–∞—Å–∏–≤–æ–π. –ê –≤ –ù–æ–≤—ã–π –≥–æ–¥ –¥–µ—Ç–∏ —É–∫—Ä–∞—Å–∏–ª–∏ –µ—ë –∏–≥—Ä—É—à–∫–∞–º–∏."},
        {title:"–ó–∏–º–∞", text:"–ó–∏–º–æ–π –≤—Å—ë –≤–æ–∫—Ä—É–≥ –ø–æ–∫—Ä—ã–ª–∞ –±–µ–ª–∞—è –ø—É—à–∏—Å—Ç–∞—è —Å–Ω–µ–∂–Ω–∞—è —à–∞–ø–∫–∞. –†–µ–±—è—Ç–∞ –ª–µ–ø–∏–ª–∏ —Å–Ω–µ–≥–æ–≤–∏–∫–æ–≤ –∏ –∫–∞—Ç–∞–ª–∏—Å—å —Å –≥–æ—Ä–æ–∫. –ù–∞ –æ–∫–Ω–∞—Ö –ø–æ—è–≤–ª—è–ª–∏—Å—å —É–∑–æ—Ä—ã –∏–∑ –∏–Ω–µ—è. –î–µ—Ç–∏ –Ω–∞—Ä—è–∂–∞–ª–∏ —ë–ª–∫—É –∫ –ù–æ–≤–æ–º—É –≥–æ–¥—É. –í –ª–µ—Å—É –∑–≤–µ—Ä–∏ –æ—Å—Ç–∞–≤–ª—è–ª–∏ —Å–ª–µ–¥—ã –Ω–∞ —Å–Ω–µ–≥—É. –ü—Ç–∏—Ü—ã –ø—Ä–∏–ª–µ—Ç–∞–ª–∏ –∫ –∫–æ—Ä–º—É—à–∫–∞–º –∑–∞ –∑—ë—Ä–Ω—ã—à–∫–∞–º–∏. –í–µ—á–µ—Ä–∞–º–∏ –±—ã–ª–æ –æ—Å–æ–±–µ–Ω–Ω–æ —É—é—Ç–Ω–æ —Å–∏–¥–µ—Ç—å –¥–æ–º–∞. –ó–∏–º–∞ –¥–∞—Ä–∏–ª–∞ —Å–∫–∞–∑–∫—É –∫–∞–∂–¥–æ–º—É. –û–Ω–∞ –±—ã–ª–∞ –≤—Ä–µ–º–µ–Ω–µ–º —á—É–¥–µ—Å –∏ —Ç–∏—à–∏–Ω—ã."},
        {title:"–¢–∞–π–Ω–∞ —Å–Ω–µ–∂–∏–Ω–∫–∏", text:"–ó–∏–º–æ–π –¥–µ–≤–æ—á–∫–∞ –ø–æ–π–º–∞–ª–∞ —Å–Ω–µ–∂–∏–Ω–∫—É –Ω–∞ –≤–∞—Ä–µ–∂–∫—É. –û–Ω–∞ —É–≤–∏–¥–µ–ª–∞, —á—Ç–æ —Å–Ω–µ–∂–∏–Ω–∫–∞ –ø–æ—Ö–æ–∂–∞ –Ω–∞ –∫—Ä–∏—Å—Ç–∞–ª–ª. –ù–æ —Å–Ω–µ–∂–∏–Ω–∫–∞ –±—ã—Å—Ç—Ä–æ —Ä–∞—Å—Ç–∞—è–ª–∞. –î–µ–≤–æ—á–∫–∞ –ø–æ–Ω—è–ª–∞: —á—É–¥–µ—Å–∞ –∂–∏–≤—É—Ç –Ω–µ–¥–æ–ª–≥–æ, –Ω–æ –æ–Ω–∏ –æ—á–µ–Ω—å –∫—Ä–∞—Å–∏–≤—ã–µ."},
        {title:"–ó–≤—ë–∑–¥–Ω–∞—è –Ω–æ—á—å", text:"–ù–∞—Å—Ç—É–ø–∏–ª –≤–µ—á–µ—Ä. –ù–∞ –Ω–µ–±–µ –ø–æ—è–≤–∏–ª–∏—Å—å —è—Ä–∫–∏–µ –∑–≤—ë–∑–¥—ã. –î–µ—Ç–∏ –≤—ã—à–ª–∏ –≤–æ –¥–≤–æ—Ä –∏ –Ω–∞—á–∞–ª–∏ –∏—Ö —Å—á–∏—Ç–∞—Ç—å. –ò–º –ø–æ–∫–∞–∑–∞–ª–æ—Å—å, —á—Ç–æ –∑–≤—ë–∑–¥—ã –ø–æ—Ö–æ–∂–∏ –Ω–∞ —Ñ–æ–Ω–∞—Ä–∏–∫–∏. –ù–æ—á—å –±—ã–ª–∞ —Ç–∏—Ö–∞—è –∏ –∫—Ä–∞—Å–∏–≤–∞—è."},
        {title:"–í–µ–ª–æ—Å–∏–ø–µ–¥", text:"–£ –°–∞—à–∏ –±—ã–ª –Ω–æ–≤—ã–π –≤–µ–ª–æ—Å–∏–ø–µ–¥. –û–Ω –ø–æ–µ—Ö–∞–ª –∫–∞—Ç–∞—Ç—å—Å—è –≤–æ –¥–≤–æ—Ä. –°–Ω–∞—á–∞–ª–∞ –æ–Ω –µ—Ö–∞–ª –º–µ–¥–ª–µ–Ω–Ω–æ, –∞ –ø–æ—Ç–æ–º –±—ã—Å—Ç—Ä–µ–µ. –ï–≥–æ –¥—Ä—É–∑—å—è —Ä–∞–¥–æ—Å—Ç–Ω–æ –±–µ–∂–∞–ª–∏ —Ä—è–¥–æ–º. –°–∞—à–∞ –Ω–∞—É—á–∏–ª—Å—è —É–≤–µ—Ä–µ–Ω–Ω–æ –¥–µ—Ä–∂–∞—Ç—å —Ä—É–ª—å."},
        {title:"–°–µ–∫—Ä–µ—Ç–Ω—ã–π –¥–æ–º–∏–∫ —É–ª–∏—Ç–∫–∏", text:"–£–ª–∏—Ç–∫–∞ –≤—Å–µ–≥–¥–∞ –Ω–æ—Å–∏—Ç —Å —Å–æ–±–æ–π —Å–≤–æ–π –¥–æ–º–∏–∫. –û–Ω –∑–∞—â–∏—â–∞–µ—Ç –µ—ë –æ—Ç –¥–æ–∂–¥—è –∏ —Å–æ–ª–Ω—Ü–∞. –ï—Å–ª–∏ —É–ª–∏—Ç–∫–µ —Å—Ç—Ä–∞—à–Ω–æ, –æ–Ω–∞ –ø—Ä—è—á–µ—Ç—Å—è –≤–Ω—É—Ç—Ä—å. –î–æ–º–∏–∫ —Ä–∞—Å—Ç—ë—Ç –≤–º–µ—Å—Ç–µ —Å —É–ª–∏—Ç–∫–æ–π, –∫–∞–∫ –Ω–∞—Å—Ç–æ—è—â–∞—è –∫—Ä–µ–ø–æ—Å—Ç—å."},
        {title:"–°–æ–Ω–Ω–æ–µ —Å–æ–ª–Ω—ã—à–∫–æ", text:"–û–¥–Ω–∞–∂–¥—ã —Å–æ–ª–Ω—Ü–µ —Ä–µ—à–∏–ª–æ –ø–æ—Å–ø–∞—Ç—å –ø–æ–¥–æ–ª—å—à–µ. –ó–µ–º–ª—è —Å—Ä–∞–∑—É –ø–æ—Ç–µ–º–Ω–µ–ª–∞, —Å—Ç–∞–ª–æ –ø—Ä–æ—Ö–ª–∞–¥–Ω–æ. –¢–æ–≥–¥–∞ –ø—Ç–∏—Ü—ã –∑–∞–ø–µ–ª–∏ –≥—Ä–æ–º–∫–æ-–≥—Ä–æ–º–∫–æ, —á—Ç–æ–±—ã —Ä–∞–∑–±—É–¥–∏—Ç—å —Å–æ–ª–Ω—ã—à–∫–æ. –ò –æ–Ω–æ —Å–Ω–æ–≤–∞ –≤—ã–≥–ª—è–Ω—É–ª–æ."},
        {title:"–í–µ—Å–Ω–∞", text:"–ó–∏–º–æ–π –≤—Å—ë –≤–æ–∫—Ä—É–≥ –±—ã–ª–æ –±–µ–ª—ã–º –∏ —Ç–∏—Ö–∏–º. –ù–æ –≤–æ—Ç —Ä–∞—Å—Ç–∞—è–ª —Å–Ω–µ–≥, –∏ –ø–æ—è–≤–∏–ª–∏—Å—å –ø–µ—Ä–≤—ã–µ –ø—Ä–æ—Ç–∞–ª–∏–Ω—ã. –ù–∞ –Ω–∏—Ö –ø—Ä–æ–±–∏–ª–∏—Å—å –∑–µ–ª—ë–Ω—ã–µ —Ç—Ä–∞–≤–∏–Ω–∫–∏. –ù–∞ –¥–µ—Ä–µ–≤—å—è—Ö –Ω–∞–±—É—Ö–ª–∏ –ø–æ—á–∫–∏. –ü—Ç–∏—Ü—ã –≤–µ—Ä–Ω—É–ª–∏—Å—å —Å —Ç—ë–ø–ª—ã—Ö –∫—Ä–∞—ë–≤ –∏ –≤–µ—Å–µ–ª–æ –∑–∞–ø–µ–ª–∏. –î–µ—Ç–∏ –∑–∞–ø—É—Å–∫–∞–ª–∏ –∫–æ—Ä–∞–±–ª–∏–∫–∏ –≤ —Ä—É—á—å—è—Ö. –°–æ–ª–Ω—Ü–µ —Å—Ç–∞–ª–æ –ø—Ä–∏–≥—Ä–µ–≤–∞—Ç—å —Å–∏–ª—å–Ω–µ–µ. –í—Å–µ –ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞–ª–∏ —Ä–∞–¥–æ—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è."},
        {title:"–ü–æ–¥—Å–æ–ª–Ω—É—Ö", text:"–°–µ–º–µ—á–∫–æ —É–ø–∞–ª–æ –≤ –∑–µ–º–ª—é –∏ –∑–∞—Å–Ω—É–ª–æ. –í–µ—Å–Ω–æ–π –µ–≥–æ —Ä–∞–∑–±—É–¥–∏–ª–æ —Å–æ–ª–Ω—ã—à–∫–æ –∏ –∫–∞–ø–µ–ª—å–∫–∏ –¥–æ–∂–¥—è. –ò–∑ —Å–µ–º–µ—á–∫–∞ –≤—ã—Ä–æ—Å –∑–µ–ª—ë–Ω—ã–π —Ä–æ—Å—Ç–æ—á–µ–∫. –ü–æ—Ç–æ–º –ø–æ—è–≤–∏–ª—Å—è –∫—Ä–∞—Å–∏–≤—ã–π –ø–æ–¥—Å–æ–ª–Ω—É—Ö."},
        {title:"–†–∞—Å—Å–∫–∞–∑—ã —Å–æ–≤—ã", text:"–í –ª–µ—Å—É –∂–∏–ª–∞ –º—É–¥—Ä–∞—è —Å–æ–≤–∞. –û–Ω–∞ —Å–æ–±–∏—Ä–∞–ª–∞ —Å–∫–∞–∑–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞–ª–∏ –∑–≤–µ—Ä–∏. –ö–∞–∂–¥—É—é –Ω–æ—á—å —Å–æ–≤–∞ —á–∏—Ç–∞–ª–∞ –∏—Ö —Å–≤–æ–∏–º –¥—Ä—É–∑—å—è–º. –í—Å–µ –∑–≤–µ—Ä–∏ —Å–ª—É—à–∞–ª–∏ —Å —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ–º."},
        {title:"–ú–µ—á—Ç–∞ –ø—Ç–µ–Ω—Ü–∞", text:"–ú–∞–ª–µ–Ω—å–∫–∏–π –ø—Ç–µ–Ω–µ—Ü —Å–∏–¥–µ–ª –≤ –≥–Ω–µ–∑–¥–µ. –û–Ω –≤–∏–¥–µ–ª, –∫–∞–∫ –≤—ã—Å–æ–∫–æ –ª–µ—Ç–∞—é—Ç –ø—Ç–∏—Ü—ã. –ï–º—É —Ç–æ–∂–µ —Ö–æ—Ç–µ–ª–æ—Å—å –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å. –ù–æ –∫—Ä—ã–ª—å—è –±—ã–ª–∏ –µ—â—ë —Å–ª–∞–±—ã–µ. –ú–∞–º–∞ —É—á–∏–ª–∞ –µ–≥–æ –º–∞—Ö–∞—Ç—å –∏–º–∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å. –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –ø—Ç–µ–Ω–µ—Ü —Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è —Å–º–µ–ª–µ–µ. –ò –≤–æ—Ç –æ–¥–Ω–∞–∂–¥—ã –æ–Ω –≤–∑–ª–µ—Ç–µ–ª. –°–Ω–∞—á–∞–ª–∞ –Ω–µ–¥–∞–ª–µ–∫–æ, –Ω–æ –ø–æ—Ç–æ–º –≤—Å—ë –≤—ã—à–µ. –ü—Ç–µ–Ω–µ—Ü –ø–æ–Ω—è–ª: –º–µ—á—Ç—ã —Å–±—ã–≤–∞—é—Ç—Å—è, –µ—Å–ª–∏ —Å—Ç–∞—Ä–∞—Ç—å—Å—è."},
        {title:"–î—Ä—É–∑—å—è –Ω–∞ –ø—Ä–æ–≥—É–ª–∫–µ", text:"–ú–∞—à–∞ –∏ –°–∞—à–∞ –ø–æ—à–ª–∏ –≥—É–ª—è—Ç—å –≤–æ –¥–≤–æ—Ä. –¢–∞–º –æ–Ω–∏ –≤—Å—Ç—Ä–µ—Ç–∏–ª–∏ –¥–µ—Ç–µ–π. –í–º–µ—Å—Ç–µ –æ–Ω–∏ –∫–∞—Ç–∞–ª–∏—Å—å –Ω–∞ –∫–∞—á–µ–ª—è—Ö –∏ –∏–≥—Ä–∞–ª–∏ –≤ –ø—Ä—è—Ç–∫–∏. –ù–∏–∫—Ç–æ –Ω–µ —Å—Å–æ—Ä–∏–ª—Å—è, –≤—Å–µ –¥–µ–ª–∏–ª–∏—Å—å –∏–≥—Ä—É—à–∫–∞–º–∏. –í–µ—á–µ—Ä–æ–º —Ä–µ–±—è—Ç–∞ –¥–æ–≥–æ–≤–æ—Ä–∏–ª–∏—Å—å –≤—Å—Ç—Ä–µ—Ç–∏—Ç—å—Å—è —Å–Ω–æ–≤–∞."},
        {title:"–ü—á—ë–ª–∫–∞ –∏ –æ–¥—É–≤–∞–Ω—á–∏–∫", text:"–ù–∞ –ø–æ–ª—è–Ω–µ –∑–∞—Ü–≤–µ–ª–∏ –∂—ë–ª—Ç—ã–µ –æ–¥—É–≤–∞–Ω—á–∏–∫–∏. –°–æ–ª–Ω—Ü–µ —Å–≤–µ—Ç–∏–ª–æ —è—Ä–∫–æ, –∏ —Ü–≤–µ—Ç—ã —Ç—è–Ω—É–ª–∏—Å—å –≤–≤–µ—Ä—Ö. –ö –Ω–∏–º –ø—Ä–∏–ª–µ—Ç–µ–ª–∞ –ø—á—ë–ª–∫–∞. –û–Ω–∞ —Å–æ–±–∏—Ä–∞–ª–∞ –Ω–µ–∫—Ç–∞—Ä –∏ –∂—É–∂–∂–∞–ª–∞. –ü—á—ë–ª–∫–∞ —Ä–∞–±–æ—Ç–∞–ª–∞ —Ü–µ–ª—ã–π –¥–µ–Ω—å."},
        {title:"–õ–µ—Ç–æ", text:"–ù–∞—Å—Ç—É–ø–∏–ª–æ –∂–∞—Ä–∫–æ–µ –ª–µ—Ç–æ. –°–æ–ª–Ω—Ü–µ —Å–≤–µ—Ç–∏–ª–æ —è—Ä–∫–æ –∏ –¥–æ–ª–≥–æ. –î–µ—Ç–∏ –∫—É–ø–∞–ª–∏—Å—å –≤ —Ä–µ—á–∫–µ –∏ –µ–ª–∏ —Å–ª–∞–¥–∫–∏–µ —è–≥–æ–¥—ã. –í —Å–∞–¥—É –ø–æ—Å–ø–µ–ª–∏ —è–±–ª–æ–∫–∏ –∏ –≥—Ä—É—à–∏. –ù–∞ –ø–æ–ª—è—Ö –∫–æ–ª–æ—Å–∏–ª–∞—Å—å –∑–æ–ª–æ—Ç–∞—è –ø—à–µ–Ω–∏—Ü–∞. –ü—á—ë–ª—ã –∂—É–∂–∂–∞–ª–∏ –∏ —Å–æ–±–∏—Ä–∞–ª–∏ –º—ë–¥. –í–µ—á–µ—Ä–∞–º–∏ —Ä–µ–±—è—Ç–∞ –∏–≥—Ä–∞–ª–∏ –≤ –ø—Ä—è—Ç–∫–∏ –¥–æ —Å–∞–º—ã—Ö —Å—É–º–µ—Ä–µ–∫. –õ–µ—Ç–æ –¥–∞—Ä–∏–ª–æ —Ä–∞–¥–æ—Å—Ç—å –∏ —Å–≤–æ–±–æ–¥—É. –û–Ω–æ –±—ã–ª–æ –≤—Ä–µ–º–µ–Ω–µ–º –∏–≥—Ä –∏ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–π."}
    ];

    /* ====== DOM ====== */
    const listEl = document.getElementById('list');
    const readerTitle = document.getElementById('readerTitle');
    const readerText = document.getElementById('readerText');
    const piecesEl = document.getElementById('pieces');
    const shuffleBtn = document.getElementById('shuffleBtn');
    const checkBtn = document.getElementById('checkBtn');
    const resetBtn = document.getElementById('resetBtn');
    const hintBtn = document.getElementById('hintBtn');
    const resultEl = document.getElementById('result');
    const scoreEl = document.getElementById('score');
    const taskIndexEl = document.getElementById('taskIndex');
    const timerEl = document.getElementById('timer');

    let currentStory = null;
    let originalSentences = [];
    let currentOrder = [];
    let score = 0;
    let timerId = null;

    /* ====== –ü–æ–º–æ—â–Ω–∏–∫–∏ ====== */
    function splitSentences(text){
        return text.split(/(?<=[.!?])\s+/).map(s=>s.trim()).filter(Boolean);
    }
    
    function shuffle(arr){
        const a = arr.slice();
        for(let i=a.length-1; i>0; i--){
            const j=Math.floor(Math.random()*(i+1));
            [a[i], a[j]] = [a[j], a[i]];
        }
        return a;
    }

    /* ====== –†–µ–Ω–¥–µ—Ä —Å–ø–∏—Å–∫–∞ —Ä–∞—Å—Å–∫–∞–∑–æ–≤ ====== */
    function renderList(){
        listEl.innerHTML = '';
        stories.forEach((s, i) => {
            const card = document.createElement('div');
            card.className = 'story-card';
            card.tabIndex = 0;
            card.innerHTML = `<h3>${s.title}</h3><p>${s.text.slice(0, 90)}${s.text.length > 90 ? '...' : ''}</p>`;
            card.addEventListener('click', () => selectStory(i));
            card.addEventListener('keydown', (e) => { if(e.key === 'Enter') selectStory(i); });
            listEl.appendChild(card);
        });
    }

    /* ====== –í—ã–±—Ä–∞—Ç—å —Ä–∞—Å—Å–∫–∞–∑ ====== */
    function selectStory(index){
        currentStory = stories[index];
        originalSentences = splitSentences(currentStory.text);
        currentOrder = shuffle(originalSentences);
        renderReader(true);
        renderPieces();
        resultEl.textContent = '';
        taskIndexEl.textContent = `${index + 1} / ${stories.length}`;
        startTimer(60);
    }

    /* ====== –†–µ–Ω–¥–µ—Ä —Ç–µ–∫—Å—Ç–∞ –≤ —á–∏—Ç–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ ====== */
    function renderReader(showText){
        if(!currentStory){
            readerTitle.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞—Å—Å–∫–∞–∑ —Å–ª–µ–≤–∞';
            readerText.textContent = '–¢–µ–∫—Å—Ç –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É ‚Äî –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –±—É–¥—É—Ç –ø–µ—Ä–µ–º–µ—à–∞–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.';
            return;
        }
        readerTitle.textContent = currentStory.title;
        if(showText) {
            readerText.innerHTML = currentStory.text.replace(/\n/g, '<br>');
        } else {
            readerText.textContent = '';
        }
    }

    /* ====== –¢–∞–π–º–µ—Ä ====== */
    function startTimer(duration){
        clearInterval(timerId);
        let timer = duration;
        timerEl.textContent = `‚è±Ô∏è ${timer} —Å–µ–∫`;

        timerId = setInterval(() => {
            timer--;
            timerEl.textContent = `‚è±Ô∏è ${timer} —Å–µ–∫`;
            if(timer <= 0){
                clearInterval(timerId);
                readerText.textContent = '';
                timerEl.textContent = '';
            }
        }, 1000);
    }

    /* ====== –†–µ–Ω–¥–µ—Ä —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ ====== */
    function renderPieces(){
        piecesEl.innerHTML = '';
        if(!currentStory){
            piecesEl.innerHTML = `<div class="hint">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–∞—Å—Å–∫–∞–∑</div>`;
            return;
        }
        currentOrder.forEach((sent, idx) => {
            const d = document.createElement('div');
            d.className = 'piece';
            d.draggable = true;
            d.dataset.index = idx;
            d.textContent = sent;
            piecesEl.appendChild(d);

            d.addEventListener('dragstart', (e) => {
                d.classList.add('dragging');
                e.dataTransfer.setData('text/plain', idx);
            });
            d.addEventListener('dragend', () => d.classList.remove('dragging'));
        });

        piecesEl.addEventListener('dragover', onDragOver);
        piecesEl.addEventListener('drop', onDrop);
    }

    /* ====== Drag & Drop handlers ====== */
    function onDragOver(e){
        e.preventDefault();
        const afterEl = getDragAfterElement(e.clientY);
        const dragging = document.querySelector('.piece.dragging');
        if(!dragging) return;
        if(afterEl == null) {
            piecesEl.appendChild(dragging);
        } else {
            piecesEl.insertBefore(dragging, afterEl);
        }
        updateOrderFromDOM();
    }
    
    function onDrop(e){
        e.preventDefault();
        updateOrderFromDOM();
    }

    function getDragAfterElement(y){
        const draggableElements = [...piecesEl.querySelectorAll('.piece:not(.dragging)')];
        return draggableElements.reduce((closest, child) => {
            const box = child.getBoundingClientRect();
            const offset = y - box.top - box.height / 2;
            if(offset < 0 && offset > closest.offset){
                return { offset: offset, element: child };
            } else {
                return closest;
            }
        }, { offset: Number.NEGATIVE_INFINITY }).element;
    }

    /* ====== –û–±–Ω–æ–≤–∏—Ç—å currentOrder –ø–æ DOM –ø–æ—Ä—è–¥–∫—É ====== */
    function updateOrderFromDOM(){
        const nodes = [...piecesEl.querySelectorAll('.piece')];
        currentOrder = nodes.map(n => n.textContent);
    }

    /* ====== –ö–Ω–æ–ø–∫–∏ ====== */
    shuffleBtn.addEventListener('click', () => {
        if(!currentStory) return alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–∞—Å—Å–∫–∞–∑ —Å–ª–µ–≤–∞');
        currentOrder = shuffle(currentOrder);
        renderPieces();
        resultEl.textContent = '–†–∞—Å—Å–∫–∞–∑ –ø–µ—Ä–µ–º–µ—à–∞–Ω.';
    });

    checkBtn.addEventListener('click', () => {
        if(!currentStory) return alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–∞—Å—Å–∫–∞–∑ —Å–ª–µ–≤–∞');
        
        clearInterval(timerId);
        timerEl.textContent = '';
        renderReader(true); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—Å—Ç –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

        updateOrderFromDOM();
        let correct = 0;
        const nodes = [...piecesEl.querySelectorAll('.piece')];
        nodes.forEach((n, i) => {
            n.classList.remove('ok', 'bad');
            if(n.textContent.trim() === originalSentences[i].trim()){
                n.classList.add('ok');
                correct++;
            } else {
                n.classList.add('bad');
            }
        });
        
        if(correct === originalSentences.length){
            resultEl.innerHTML = `<span style="color:var(--ok)">‚úÖ –û—Ç–ª–∏—á–Ω–æ! –ü—Ä–∞–≤–∏–ª—å–Ω–æ: ${correct}/${originalSentences.length}. +1 –æ—á–∫–æ</span>`;
            score += 1;
            scoreEl.textContent = score;
        } else {
            resultEl.innerHTML = `<span style="color:var(--bad)">‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ: ${correct}/${originalSentences.length}. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.</span>`;
        }
    });

    resetBtn.addEventListener('click', () => {
        if(!currentStory) return;
        currentOrder = originalSentences.slice();
        renderPieces();
        resultEl.textContent = '–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫.';
        
        clearInterval(timerId);
        timerEl.textContent = '';
        renderReader(true);
    });

    hintBtn.addEventListener('click', () => {
        if(!currentStory) return alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–∞—Å—Å–∫–∞–∑ —Å–ª–µ–≤–∞');
        
        if(score > 0){
            updateOrderFromDOM();
            
            const firstIncorrectIndex = currentOrder.findIndex((sent, i) => sent.trim() !== originalSentences[i].trim());

            if(firstIncorrectIndex !== -1){
                const correctSentence = originalSentences[firstIncorrectIndex];
                const pieceNodes = [...piecesEl.querySelectorAll('.piece')];
                const correctPiece = pieceNodes.find(p => p.textContent.trim() === correctSentence.trim());
                
                if(correctPiece){
                    const targetNode = pieceNodes[firstIncorrectIndex];
                    piecesEl.insertBefore(correctPiece, targetNode);
                    
                    updateOrderFromDOM();
                    score--;
                    scoreEl.textContent = score;
                    resultEl.innerHTML = `<span style="color:var(--accent)">üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞. ${firstIncorrectIndex + 1}-–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç —Ç–µ–ø–µ—Ä—å –Ω–∞ —Å–≤–æ–µ–º –º–µ—Å—Ç–µ.</span>`;
                }
            } else {
                resultEl.innerHTML = `<span style="color:var(--ok)">üéâ –í—Å–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ! –ü–æ–¥—Å–∫–∞–∑–∫–∞ –Ω–µ –Ω—É–∂–Ω–∞.</span>`;
            }
        } else {
            resultEl.innerHTML = `<span style="color:var(--bad)">üòî –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—á–∫–æ–≤ –¥–ª—è –ø–æ–¥—Å–∫–∞–∑–∫–∏.</span>`;
        }
    });

    /* ====== –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ====== */
    renderList();
    renderReader(false);
    renderPieces();
</script>
</body>
</html>